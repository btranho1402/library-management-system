<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Library System - Login</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css" />
  <style>
    .brand-logo { max-height: clamp(24px, 6vw, 44px); height: auto; width: auto; object-fit: contain; display: block; }
    .navbar-brand { min-width: 0; }
    .brand-text { white-space: nowrap; }
    .glass { backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); background: rgba(255,255,255,0.65); border-radius: 1rem; box-shadow: 0 8px 30px rgba(0,0,0,0.08); }
  </style>
</head>
<body>
  <!-- Top Navbar Layout -->
  <nav class="navbar navbar-expand-lg bg-dark navbar-dark">
    <div class="container-lg">
      <a href="#" class="navbar-brand d-flex align-items-center gap-2">
        <span class="brand-text fw-semibold">Library System</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav"
              aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse mt-3 mt-lg-0" id="nav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" href="#" aria-current="page">Home</a></li> 
          <li class="nav-item"><a class="nav-link" href="books_management.html">Books Management</a></li>
          <li class="nav-item"><a class="nav-link" href="others.html">Others</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Login Card -->
  <div class="container-fluid glass mt-5 mx-auto p-4 p-md-5" style="width: 70%; max-width: 980px;">
    <h2 class="text-center mt-1">Welcome to the Library System</h2>
    <p class="text-center text-muted mb-4">Please sign in to continue</p>

    <!-- Alert Area for Error Messages -->
    <div id="alertArea" class="mx-auto px-3" style="max-width: 520px;"></div>

    <form class="mx-auto px-3 mt-4" style="max-width: 520px;" id="loginForm">
      <!-- Account -->
      <div class="mb-3">
        <label for="account" class="form-label">Account</label>
        <input
          type="text"
          class="form-control"
          id="account"
          name="account"
          placeholder="Enter your account ID"
          autocomplete="username"
        >
      </div>

      <!-- Password + toggle -->
      <div class="mb-3">
        <label for="password" class="form-label">Password</label>
        <div class="input-group">
          <input
            type="password"
            class="form-control"
            id="password"
            name="password"
            placeholder="Enter your password"
            autocomplete="current-password"
          >
          <button class="btn btn-outline-secondary" type="button" id="togglePwd" aria-label="Show or hide password">
            Show
          </button>
        </div>
      </div>

      <!-- Buttons -->
      <div class="row justify-content-evenly">
        <div class="col-6 col-md-5 d-grid">
          <button type="submit" class="btn btn-primary">Sign In</button>
        </div>
        <div class="col-6 col-md-5 d-grid">
          <button type="reset" class="btn btn-secondary">Clear</button>
        </div>
      </div>

      <hr class="my-4">

      <p class="text-center text-muted mb-0">
        Need help (forgot password / no account)?&nbsp;
        <a href="#" class="link-primary link-underline-opacity-0 link-underline-opacity-100-hover">Contact administrator</a>
      </p>
    </form>

    <!-- Demo Accounts Section -->
    <div class="mx-auto px-3 mt-4" style="max-width: 520px;">
      <div class="alert alert-info mb-3">
        <h6 class="alert-heading mb-3">Demo Accounts (for grading)</h6>
        <p class="small mb-2">Admin can add books; User can borrow/return.</p>
        
        <!-- Admin Demo Account -->
        <div class="mb-3 p-2 bg-white rounded border">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <strong>Admin Demo</strong>
            <button type="button" class="btn btn-sm btn-outline-primary" id="fillAdminBtn">Auto-fill</button>
          </div>
          <div class="small">
            <div>Username: <code>admin</code></div>
            <div>Password: <code>admin123</code></div>
          </div>
        </div>

        <!-- User Demo Account -->
        <div class="p-2 bg-white rounded border">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <strong>User Demo</strong>
            <button type="button" class="btn btn-sm btn-outline-primary" id="fillUserBtn">Auto-fill</button>
          </div>
          <div class="small">
            <div>Username: <code>bob</code></div>
            <div>Password: <code>bob123</code></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
          crossorigin="anonymous"></script>
  <script src="./api.js"></script>
  <script>
    (function () {
      const form = document.getElementById('loginForm');
      const togglePwdBtn = document.getElementById('togglePwd');
      const pwdInput = document.getElementById('password');
      const accountInput = document.getElementById('account');
      const fillAdminBtn = document.getElementById('fillAdminBtn');
      const fillUserBtn = document.getElementById('fillUserBtn');

      // Show/Hide password only
      togglePwdBtn.addEventListener('click', () => {
        const isPwd = pwdInput.type === 'password';
        pwdInput.type = isPwd ? 'text' : 'password';
        togglePwdBtn.textContent = isPwd ? 'Hide' : 'Show';
      });

      // Auto-fill Admin Demo account
      fillAdminBtn.addEventListener('click', () => {
        accountInput.value = 'admin';
        pwdInput.value = 'admin123';
        // Reset password field type to password if it was shown
        if (pwdInput.type === 'text') {
          pwdInput.type = 'password';
          togglePwdBtn.textContent = 'Show';
        }
      });

      // Auto-fill User Demo account
      fillUserBtn.addEventListener('click', () => {
        accountInput.value = 'bob';
        pwdInput.value = 'bob123';
        // Reset password field type to password if it was shown
        if (pwdInput.type === 'text') {
          pwdInput.type = 'password';
          togglePwdBtn.textContent = 'Show';
        }
      });

      // Handle form submission
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const username = document.getElementById('account').value.trim();
        const password = document.getElementById('password').value;
        
        if (!username || !password) {
          showAlert('Please enter both username and password', 'warning');
          return;
        }
        
        try {
          const response = await apiPost('/login', {
            username: username,
            password: password
          });
          
          if (response.success && response.user) {
            // Store user to localStorage with only required fields from backend response
            const currentUser = {
              user_id: response.user.user_id,
              user_name: response.user.user_name,
              is_admin: response.user.is_admin
            };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            // Redirect to home page
            window.location.href = 'home.html';
          } else {
            showAlert('Login failed. Please check your credentials.', 'danger');
          }
        } catch (error) {
          showAlert(`Login error: ${error.message.replace(/^HTTP \d+: /, '')}`, 'danger');
        }
      });
      
      // Show alert message
      function showAlert(message, type = 'danger') {
        const alertArea = document.getElementById('alertArea');
        alertArea.innerHTML = `
          <div class="alert alert-${type} alert-dismissible fade show" role="alert">
            ${escapeHTML(message)}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        `;
      }
      
      // Utility for HTML escaping
      function escapeHTML(str) {
        if (typeof str !== 'string') return str;
        const div = document.createElement('div');
        div.appendChild(document.createTextNode(str));
        return div.innerHTML;
      }

      // Clear reset password field type
      form.addEventListener('reset', () => {
        if (pwdInput.type === 'text') {
          pwdInput.type = 'password';
          togglePwdBtn.textContent = 'Show';
        }
      });
    })();
  </script>
</body>
</html>